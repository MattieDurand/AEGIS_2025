<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Online Doctor - Medical Assistant</title>
  <link rel="stylesheet" href="styles.css?v=1.1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <!-- HEADER -->
  <header id="header">
    <img src="https://cdn-icons-png.flaticon.com/512/3524/3524659.png" alt="logo" />
    <h1>AI Online Doctor</h1>
  </header>

  <!-- CONNECTION STATUS -->
  <div id="connection-status">
    <div class="loader"></div>
    <p>Checking Groq API connection...</p>
  </div>

  <!-- MAIN CONTENT -->
  <main id="main-container" style="display:none;">
    <!-- Body Part Selection -->
    <section id="body-part-selection" class="active">
      <div class="card" onclick="goToSymptoms('Head')"><i class="fa-solid fa-user"></i> Head</div>
      <div class="card" onclick="goToSymptoms('Chest')"><i class="fa-solid fa-heart"></i> Chest</div>
      <div class="card" onclick="goToSymptoms('Abdomen')"><i class="fa-solid fa-stomach"></i> Abdomen</div>
      <div class="card" onclick="goToSymptoms('Leg')"><i class="fa-solid fa-walking"></i> Leg</div>
    </section>

    <!-- Symptom Selection -->
    <section id="symptom-selection">
      <h2 id="symptom-title"></h2>
      <div id="symptom-cards"></div>
      <div class="card back-btn" onclick="backToBodyParts()">
        <i class="fa-solid fa-arrow-left"></i> Back
      </div>
    </section>
  </main>

  <!-- Info Modal -->
  <div id="infoBox" class="info-box">
    <span class="close-btn" onclick="closeInfoBox()">×</span>
    <h3>Treatment Plan</h3>
    <p id="infoContent"></p>
  </div>
  <div id="overlay" class="overlay" onclick="closeInfoBox()"></div>

  <!-- JAVASCRIPT -->
  <script>
    /* ==========================
       CONNECTION CHECK
    ========================== */
    async function checkGroqConnection() {
      try {
        const response = await fetch("https://api.groq.com/v1/models", {
          method: "GET",
          headers: { "Content-Type": "application/json" }
        });

        if (!response.ok) throw new Error("Groq API unavailable");

        // Connection works → show main app
        document.getElementById("connection-status").style.display = "none";
        document.getElementById("main-container").style.display = "block";
      } catch (err) {
        document.getElementById("connection-status").innerHTML =
          `<p style="color:red;">❌ Failed to connect to Groq API. Please try again later.</p>`;
      }
    }

    window.onload = checkGroqConnection;

    /* ==========================
       SYMPTOM DATA
    ========================== */
    const symptomOptions = {
      Head: ["Headache", "Dizziness", "Vision Problems"],
      Chest: ["Chest Pain", "Cough", "Shortness of Breath"],
      Abdomen: ["Stomach Pain", "Nausea", "Diarrhea"],
      Leg: ["Pain", "Swelling", "Numbness"]
    };

    /* ==========================
       NAVIGATION
    ========================== */
    function goToSymptoms(bodyPart) {
      document.getElementById("body-part-selection").classList.remove("active");
      document.getElementById("symptom-selection").classList.add("active");
      document.getElementById("symptom-title").innerText =
        `Select a symptom for ${bodyPart}`;

      const symptomCards = document.getElementById("symptom-cards");
      symptomCards.innerHTML = "";
      symptomOptions[bodyPart].forEach(sym => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `<i class="fa-solid fa-notes-medical"></i> ${sym}`;
        div.onclick = () => requestTreatment(bodyPart, sym);
        symptomCards.appendChild(div);
      });
    }

    function backToBodyParts() {
      document.getElementById("symptom-selection").classList.remove("active");
      document.getElementById("body-part-selection").classList.add("active");
    }

    /* ==========================
       INFO MODAL
    ========================== */
    function openInfoBox(content) {
      document.getElementById("infoContent").innerText = content;
      document.getElementById("infoBox").classList.add("active");
      document.getElementById("overlay").classList.add("active");
    }

    function closeInfoBox() {
      document.getElementById("infoBox").classList.remove("active");
      document.getElementById("overlay").classList.remove("active");
    }

    /* ==========================
       TREATMENT REQUEST
    ========================== */
    async function requestTreatment(bodyPart, symptom) {
      try {
        const response = await fetch("/.netlify/functions/groq-proxy", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            prompt: `Suggest a treatment plan for ${symptom} in the ${bodyPart}.`
          })
        });

        if (!response.ok) throw new Error("Groq request failed");

        const data = await response.json();
        openInfoBox(data.reply || "No response from Groq.");
      } catch (err) {
        openInfoBox("❌ Error fetching treatment plan.");
      }
    }
  </script>
</body>
</html>

